# 🎮 コインハンター アドベンチャー - 引き継ぎ資料

**最終更新**: 2025-06-16  
**前回作業**: Issue #38「多ステージ化の準備」完了  
**現在の状況**: JSONベースステージシステム完全実装済み

---

## 📋 プロジェクト現況

### ✅ 完了済み主要機能

#### 🏗️ **多ステージ化基盤（Issue #38 - 完了済み）**
- **JSONベースステージシステム**: `levels/stage1.json`にステージデータを外部化
- **LevelLoaderクラス**: 動的ステージ読み込み機能
- **ステージリスト管理**: `levels/stages.json`でステージ一覧管理
- **進行状況保存**: localStorage使用のセーブ機能
- **レガシーコード削除**: 古いハードコードレベルシステム完全除去

#### 🎨 **SVGグラフィックシステム**
- プレイヤー・敵・アイテムの完全SVG化
- キャッシュ機能付きの高速描画
- アニメーション対応（歩行・ジャンプ・アイドル）
- HTTPサーバー必須の外部ファイル読み込み

#### 🎵 **音楽・効果音システム**
- 背景音楽とゲーム効果音
- 音量調整とミュート機能
- ゲーム状態に応じた音楽切り替え

#### 🧪 **包括的テストシステム**
- **tests/test.html**: 20件の自動テスト（全成功）
- **実ブラウザテスト機能**: Playwright/Puppeteer対応
- **基本動作確認**: `scripts/headless-check.js`
- **APIベーステスト**: Node.js環境での事前確認

---

## 🚀 現在のゲーム仕様

### 🎮 **基本ゲームプレイ**
- **ジャンプアクション**: 可変ジャンプ（長押し対応）
- **コイン収集**: 回転アニメーション付き
- **敵との接触**: ダメージ・ライフシステム
- **スプリング**: 高ジャンプ補助アイテム
- **ゴール**: フラグ到達でクリア

### 📊 **レベル構造**
1. **チュートリアルエリア** (0-800px): 基本操作習得
2. **ジャンプチャレンジ** (800-1600px): 空中プラットフォーム
3. **垂直チャレンジ** (1600-2400px): 高度な登坂アクション
4. **最終チャレンジ** (2400-3000px): 難易度最高の総合テスト

### 🏛️ **技術アーキテクチャ**
```
src/
├── game.js              # メインゲームロジック
├── level-loader.js      # JSONステージ読み込み
├── config.js            # ゲーム設定値
├── levels.js            # レガシー（最小化済み）
├── music.js             # 音楽システム
├── svg-*-renderer.js    # SVG描画エンジン群
└── player-graphics.js   # プレイヤー描画制御

levels/
├── stages.json          # ステージリスト
└── stage1.json          # ステージ1データ（プラットフォーム、敵、コイン配置）

assets/
├── player-*.svg         # プレイヤーアニメーション
├── slime.svg, bird.svg  # 敵キャラクター
└── coin.svg, flag.svg   # アイテム・ゴール
```

---

## 🔧 最近の重要修正

### **Issue #38 完了時の追加修正（2025-06-16）**

#### 1. **ゲーム初期化エラー完全修正**
- **問題**: Node.js環境でのブラウザAPI呼び出し失敗
- **修正**: 環境保護機能を強化、テスト環境での安定動作を実現

#### 2. **デバッグログ整理**
- **問題**: 大量のSVG描画・ジャンプ・座標検出ログでコンソール汚染
- **修正**: 重要なエラーメッセージのみ表示、開発効率向上

#### 3. **テスト環境パス問題解決**
- **問題**: `tests/test.html`からのJSONファイル404エラー
- **修正**: 動的パス解決機能を実装

#### 4. **favicon・UI改善**
- コイン型SVGファビコン追加
- ブラウザタブの視覚的改善

---

## 🛠️ 開発環境セットアップ

### **必須手順**
```bash
# HTTPサーバー起動（CORS対策）
python3 -m http.server 8080

# アクセスURL
# メイン: http://localhost:8080/
# テスト: http://localhost:8080/tests/test.html
```

### **開発ツール**
```bash
# 基本動作確認
node scripts/headless-check.js

# テスト結果検証
node scripts/curl-test-validator.js

# コード品質チェック
npm run lint
```

---

## 📝 開発ルール・注意事項

### **必須ワークフロー（CLAUDE.md準拠）**
1. **Issue開始前**: GitHubでIssue状況確認・コメント
2. **開発中**: 細かくコミット、HTTPサーバー経由でテスト
3. **完了時**: PRコメントで詳細報告、Issue自動クローズ

### **重要な制約**
- **HTTPサーバー必須**: file://プロトコルではSVG読み込み不可
- **キャッシュ問題**: ブラウザ強制リロード（Ctrl+F5）が必要な場合あり
- **環境保護**: Node.js環境でのDOM操作防止機能実装済み

### **テスト基準**
- **ブラウザテスト**: 20件中20件成功必須
- **実動作確認**: 実際のゲームプレイで動作検証
- **コンソールクリーン**: エラーメッセージなしで動作

---

## 🎯 次期開発候補

### **準備完了済み機能**
1. **追加ステージ**: stage2.json, stage3.json等の作成
2. **ステージ選択UI**: stages.jsonベースの選択画面
3. **移動プラットフォーム**: レベルデザインコメントで準備済み

### **拡張可能要素**
- **新敵キャラクター**: SVGファイル追加で簡単実装
- **新アイテム**: パワーアップアイテム等
- **スコアシステム**: タイムアタック・ランキング機能
- **セーブ機能拡張**: クラウドセーブ対応

---

## 🚨 トラブルシューティング

### **よくある問題**

#### **「ステージデータが読み込まれていません」エラー**
- HTTPサーバーが動いているか確認
- ブラウザ強制リロード（Ctrl+F5）実行
- levels/stage1.jsonファイル存在確認

#### **SVG表示されない**
- HTTPサーバー経由でアクセスしているか確認
- assets/フォルダにSVGファイルが存在するか確認
- コンソールでCORSエラーチェック

#### **テスト失敗**
- tests/test.htmlブラウザで確認
- 期待される20件中20件成功の確認
- headless-check.jsで事前確認

---

## 📊 プロジェクト統計

- **総ファイル数**: 30+
- **コード行数**: 3000+行
- **テストカバレッジ**: 20件の包括的テスト
- **完了Issue数**: 40+ (直近: #38)
- **開発期間**: 継続開発中

---

## 🔗 重要ファイル・リンク

### **設定ファイル**
- `CLAUDE.md`: 開発ルール詳細
- `package.json`: 依存関係・スクリプト
- `.test-results.json`: 最新テスト結果

### **GitHub関連**
- Repository: `becky3/coin-hunter-adventure`
- 最新PR: #42 (Issue #38対応)
- Active Branch: `main`

---

**📞 引き継ぎ完了。何か質問があれば、この資料とCLAUDE.mdを参照してください。**