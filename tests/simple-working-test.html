<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒ³ãƒ—ãƒ«å‹•ä½œãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .result { padding: 10px; margin: 5px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ã‚·ãƒ³ãƒ—ãƒ«å‹•ä½œãƒ†ã‚¹ãƒˆ</h1>
    <div id="results">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</div>

    <!-- ç›´æ¥scriptèª­ã¿è¾¼ã¿ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¹ãƒ†ã‚£ãƒ³ã‚°ä»˜ãï¼‰ -->
    <script src="../src/config.js?test=1"></script>
    <script src="../src/levels.js?test=1"></script>
    <script src="../src/music.js?test=1"></script>
    <script src="../src/player-graphics.js?test=1"></script>
    <script src="../src/svg-renderer.js?test=1"></script>
    <script src="../src/svg-player-renderer.js?test=1"></script>
    <script src="../src/svg-enemy-renderer.js?test=1"></script>
    <script src="../src/svg-item-renderer.js?test=1"></script>
    <script src="../src/game.js?test=1"></script>
    
    <script>
        // CORSè­¦å‘Šã‚’ç„¡åŠ¹åŒ–
        window.DISABLE_CORS_WARNING = true;
        
        // çµæœè¡¨ç¤ºé–¢æ•°
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }
        
        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        setTimeout(() => {
            addResult('=== ã‚·ãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            let successCount = 0;
            let errorCount = 0;
            
            try {
                // åŸºæœ¬è¨­å®šãƒ†ã‚¹ãƒˆ
                if (typeof CANVAS_WIDTH !== 'undefined') {
                    addResult(`âœ… CANVAS_WIDTH = ${CANVAS_WIDTH}`, 'success');
                    successCount++;
                } else {
                    addResult('âŒ CANVAS_WIDTHæœªå®šç¾©', 'error');
                    errorCount++;
                }
                
                if (typeof PLAYER_CONFIG !== 'undefined') {
                    addResult(`âœ… PLAYER_CONFIG = ${JSON.stringify(PLAYER_CONFIG)}`, 'success');
                    successCount++;
                } else {
                    addResult('âŒ PLAYER_CONFIGæœªå®šç¾©', 'error');
                    errorCount++;
                }
                
                // ãƒ¬ãƒ™ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ
                if (typeof levelData !== 'undefined' && levelData.platforms) {
                    addResult(`âœ… levelData = ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ${levelData.platforms.length}å€‹`, 'success');
                    successCount++;
                } else {
                    addResult('âŒ levelDataæœªå®šç¾©', 'error');
                    errorCount++;
                }
                
                // ã‚¯ãƒ©ã‚¹ãƒ†ã‚¹ãƒˆ
                const classes = ['GameState', 'Player', 'InputManager'];
                classes.forEach(className => {
                    if (typeof window[className] !== 'undefined') {
                        addResult(`âœ… ${className}ã‚¯ãƒ©ã‚¹å®šç¾©æ¸ˆã¿`, 'success');
                        successCount++;
                    } else {
                        addResult(`âŒ ${className}ã‚¯ãƒ©ã‚¹æœªå®šç¾©`, 'error');
                        errorCount++;
                    }
                });
                
                // å®Ÿéš›ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãƒ†ã‚¹ãƒˆ
                try {
                    const gameState = new GameState();
                    addResult(`âœ… GameStateä½œæˆæˆåŠŸ: çŠ¶æ…‹=${gameState.state}`, 'success');
                    successCount++;
                    
                    const player = new Player(100, 200);
                    addResult(`âœ… Playerä½œæˆæˆåŠŸ: ä½ç½®=(${player.x}, ${player.y})`, 'success');
                    successCount++;
                    
                    // ç§»å‹•ãƒ†ã‚¹ãƒˆ
                    player.handleInput({ right: true, left: false, jump: false });
                    addResult(`âœ… Playerå³ç§»å‹•: velX=${player.velX}`, 'success');
                    successCount++;
                    
                    // ã‚¸ãƒ£ãƒ³ãƒ—ãƒ†ã‚¹ãƒˆ
                    player.onGround = true;
                    player.isJumping = false;
                    player.handleInput({ right: false, left: false, jump: true });
                    const jumpResult = player.velY < 0 ? 'success' : 'error';
                    addResult(`${jumpResult === 'success' ? 'âœ…' : 'âŒ'} Playerã‚¸ãƒ£ãƒ³ãƒ—: velY=${player.velY}`, jumpResult);
                    if (jumpResult === 'success') successCount++; else errorCount++;
                    
                } catch (error) {
                    addResult(`âŒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    errorCount++;
                }
                
                // çµæœã¾ã¨ã‚
                addResult('=== ãƒ†ã‚¹ãƒˆçµæœ ===');
                addResult(`åˆè¨ˆ: ${successCount + errorCount}ä»¶ | æˆåŠŸ: ${successCount}ä»¶ | å¤±æ•—: ${errorCount}ä»¶`, 
                         errorCount === 0 ? 'success' : 'error');
                
                if (errorCount === 0) {
                    addResult('ğŸ‰ å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸï¼', 'success');
                } else {
                    addResult(`âš ï¸ ${errorCount}ä»¶ã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¦ã„ã¾ã™`, 'error');
                }
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«çµæœã‚’è¨­å®š
                window.TEST_RESULTS = {
                    total: successCount + errorCount,
                    passed: successCount,
                    failed: errorCount,
                    status: errorCount === 0 ? 'success' : 'failed'
                };
                
                addResult('ãƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                addResult(`ğŸ’¥ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                window.TEST_RESULTS = {
                    total: 0,
                    passed: 0,
                    failed: 1,
                    status: 'error',
                    error: error.message
                };
            }
        }, 2000); // 2ç§’å¾…æ©Ÿã—ã¦ã‹ã‚‰ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    </script>
</body>
</html>