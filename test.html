<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚²ãƒ¼ãƒ ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f2f5;
            color: #1a1a1a;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #34495e;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        h3 {
            margin: 15px 0;
            font-size: 1.3em;
        }
        
        .test-results {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .overall-summary {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .overall-summary.test-pass {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #28a745;
        }
        
        .overall-summary.test-fail {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border: 2px solid #dc3545;
        }
        
        .overall-summary h3 {
            margin: 0 0 10px 0;
            font-size: 1.6em;
        }
        
        .overall-summary p {
            margin: 0;
            font-size: 1.1em;
            color: #333;
        }
        
        .test-category {
            margin-bottom: 25px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }
        
        .test-category h3 {
            margin: 0;
            padding: 15px 20px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            font-size: 1.4em;
        }
        
        .test-category.category-pass h3 {
            background-color: #e7f5e7;
            color: #155724;
        }
        
        .test-category.category-fail h3 {
            background-color: #fde7e9;
            color: #721c24;
        }
        
        .category-summary {
            padding: 12px 20px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            font-size: 0.95em;
            color: #6c757d;
        }
        
        .test-details {
            background-color: #fff;
            padding: 10px 20px 15px;
        }
        
        .test-item {
            margin: 8px 0;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.95em;
            transition: all 0.2s ease;
        }
        
        .test-item:hover {
            transform: translateX(5px);
        }
        
        .test-pass {
            background-color: #e7f5e7;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .test-fail {
            background-color: #fde7e9;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        #gameCanvas {
            display: none;
        }
        
        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .test-category {
            animation: slideIn 0.5s ease forwards;
        }
        
        .test-category:nth-child(2) {
            animation-delay: 0.1s;
        }
        
        .test-category:nth-child(3) {
            animation-delay: 0.2s;
        }
        
        /* è¿½åŠ ãƒ†ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .additional-tests {
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .test-button {
            display: inline-block;
            padding: 12px 24px;
            margin: 10px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,123,255,0.3);
        }
        
        .test-button.level-test {
            background-color: #28a745;
        }
        
        .test-button.level-test:hover {
            background-color: #218838;
        }
        
        .level-test-output {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ã‚²ãƒ¼ãƒ ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ</h1>
    
    <div class="test-results" id="testResults">
        <p>ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...</p>
    </div>
    
    <!-- è¿½åŠ ãƒ†ã‚¹ãƒˆ -->
    <div class="additional-tests">
        <h2>ğŸ® è¿½åŠ ãƒ†ã‚¹ãƒˆ</h2>
        
        <div>
            <h3>ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆ</h3>
            <p>ãƒ¬ãƒ™ãƒ«è¨­è¨ˆã®é™çš„è§£æã¨é«˜é€Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ï¼ˆç´„3ç§’ï¼‰</p>
            <button class="test-button level-test" onclick="runLevelTest()">
                âš¡ ç°¡æ˜“ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            </button>
            <div id="levelTestOutput" class="level-test-output" style="display: none;"></div>
        </div>
        
        <div style="margin-top: 20px;">
            <h3>ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ</h3>
            <p>ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼š</p>
            <div class="level-test-output">
# åŸºæœ¬ãƒ†ã‚¹ãƒˆ
npm test

# ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆï¼ˆã“ã®ãƒšãƒ¼ã‚¸ï¼‰
npm run test-browser

# ç°¡æ˜“ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆ
npm run test-level

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run serve
            </div>
        </div>
    </div>
    
    <!-- ãƒ†ã‚¹ãƒˆç”¨ã®éš ã—Canvas -->
    <canvas id="gameCanvas" width="1024" height="576"></canvas>
    
    <!-- ã‚²ãƒ¼ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script src="config.js"></script>
    <script src="levels.js"></script>
    <script src="music.js"></script>
    <script src="game.js"></script>
    <script src="test-levelplay-simple.js"></script>
    <script src="test.js"></script>
    
    <script>
        // ç°¡æ˜“ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–¢æ•°
        async function runLevelTest() {
            const button = document.querySelector('.level-test');
            const output = document.getElementById('levelTestOutput');
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            button.disabled = true;
            button.textContent = 'â³ å®Ÿè¡Œä¸­...';
            
            // å‡ºåŠ›ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
            output.style.display = 'block';
            output.textContent = 'ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...\n';
            
            try {
                // SimpleLevelTestã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
                if (typeof SimpleLevelTest === 'undefined') {
                    throw new Error('SimpleLevelTestã‚¯ãƒ©ã‚¹ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                // å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
                if (typeof levelData === 'undefined') {
                    throw new Error('levelDataãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                output.textContent += `ãƒ¬ãƒ™ãƒ«ãƒ‡ãƒ¼ã‚¿ç¢ºèª:\n`;
                output.textContent += `- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ•°: ${levelData.platforms ? levelData.platforms.length : 'æœªå®šç¾©'}\n`;
                output.textContent += `- æ•µæ•°: ${levelData.enemies ? levelData.enemies.length : 'æœªå®šç¾©'}\n`;
                output.textContent += `- ã‚³ã‚¤ãƒ³æ•°: ${levelData.coins ? levelData.coins.length : 'æœªå®šç¾©'}\n`;
                output.textContent += `- ã‚´ãƒ¼ãƒ«ä½ç½®: ${levelData.flag ? levelData.flag.x : 'æœªå®šç¾©'}\n\n`;
                
                const levelTest = new SimpleLevelTest();
                
                // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                const startTime = performance.now();
                const result = await levelTest.runQuickTest();
                const endTime = performance.now();
                
                // çµæœã‚’è¡¨ç¤º
                let outputText = `=== ç°¡æ˜“ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆçµæœ ===\n`;
                outputText += `çµæœ: ${result.passed ? 'âœ… åˆæ ¼' : 'âŒ è¦ä¿®æ­£'}\n`;
                outputText += `å®Ÿè¡Œæ™‚é–“: ${((endTime - startTime) / 1000).toFixed(2)}ç§’\n`;
                outputText += `é€²è¡Œåº¦: ${result.progress.toFixed(1)}%\n`;
                outputText += `å•é¡Œæ•°: ${result.summary.total} (é‡è¦: ${result.summary.high}, ä¸­ç¨‹åº¦: ${result.summary.medium})\n`;
                
                if (result.issues.length > 0) {
                    outputText += `\næ¤œå‡ºã•ã‚ŒãŸå•é¡Œ:\n`;
                    result.issues.forEach((issue, index) => {
                        const severity = issue.severity === 'high' ? 'ğŸ”´' : 'ğŸŸ¡';
                        outputText += `  ${index + 1}. ${severity} ${issue.message} (ä½ç½®: ${issue.position}px)\n`;
                    });
                }
                
                if (result.passed) {
                    outputText += `\nğŸ‘ ãƒ¬ãƒ™ãƒ«ã¯åŸºæœ¬çš„ãªå•é¡ŒãŒãªãã€ãƒ—ãƒ¬ã‚¤å¯èƒ½ã¨æ€ã‚ã‚Œã¾ã™ã€‚`;
                } else {
                    outputText += `\nâš ï¸  é‡è¦ãªå•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚ä¿®æ­£ã‚’æ¨å¥¨ã—ã¾ã™ã€‚`;
                }
                
                output.textContent = outputText;
                
            } catch (error) {
                output.textContent += `âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}\n\n`;
                output.textContent += `ãƒ‡ãƒãƒƒã‚°æƒ…å ±:\n`;
                output.textContent += `- URL: ${window.location.href}\n`;
                output.textContent += `- ãƒ—ãƒ­ãƒˆã‚³ãƒ«: ${window.location.protocol}\n`;
                output.textContent += `- SimpleLevelTest: ${typeof SimpleLevelTest}\n`;
                output.textContent += `- levelData: ${typeof levelData}\n`;
                output.textContent += `- performance: ${typeof performance}\n\n`;
                output.textContent += `è§£æ±ºæ–¹æ³•:\n`;
                output.textContent += `HTTPã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„:\n`;
                output.textContent += `npm run serve\n`;
                output.textContent += `http://localhost:8080/test.html\n\n`;
                output.textContent += `ã‚¨ãƒ©ãƒ¼è©³ç´°:\n${error.stack || 'ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãªã—'}`;
            } finally {
                // ãƒœã‚¿ãƒ³ã‚’å†æœ‰åŠ¹åŒ–
                button.disabled = false;
                button.textContent = 'âš¡ ç°¡æ˜“ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ';
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ã®åˆ©ç”¨å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯
            if (typeof SimpleLevelTest !== 'undefined') {
                console.log('âœ… SimpleLevelTestã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨å¯èƒ½ã§ã™');
            } else {
                console.log('âŒ SimpleLevelTestã‚¯ãƒ©ã‚¹ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                const button = document.querySelector('.level-test');
                if (button) {
                    button.textContent = 'âŒ ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆï¼ˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ï¼‰';
                    button.disabled = true;
                }
            }
        });
    </script>
</body>
</html>